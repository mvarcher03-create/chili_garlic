{% extends 'admin_base.html' %}

{% block title %}Orders · Chili Garlic House{% endblock %}

{% block header_title %}Orders{% endblock %}

{% block content %}
	<section style="display:flex; flex-direction:column; gap:1rem;">
		<div class="card-surface" style="padding:0.9rem 1rem; overflow-x:auto;">
			<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.4rem; gap:0.75rem; flex-wrap:wrap;">
				<div>
					<h2 style="font-size:0.95rem; margin-bottom:0.15rem;">All orders</h2>
					<p style="font-size:0.8rem; color:#6b7280; margin:0;">Latest orders placed by customers.</p>
				</div>
			</div>
			<table style="width:100%; border-collapse:collapse; font-size:0.9rem;">
				<thead>
					<tr style="text-align:left; border-bottom:1px solid rgba(148,163,184,0.4);">
						<th style="padding:0.4rem 0.25rem;">Order #</th>
						<th style="padding:0.4rem 0.25rem;">Customer</th>
						<th style="padding:0.4rem 0.25rem;">Items</th>
						<th style="padding:0.4rem 0.25rem;">Total</th>
						<th style="padding:0.4rem 0.25rem;">Status</th>
						<th style="padding:0.4rem 0.25rem;">Placed</th>
					</tr>
				</thead>
				<tbody>
					{% for order in orders %}
						<tr>
							<td style="padding:0.4rem 0.25rem;">#{{ order.id }}</td>
							<td style="padding:0.4rem 0.25rem;">{{ order.customer.username }}</td>
							<td style="padding:0.4rem 0.25rem;">
								{% with first=order.items.all|first %}
									{% if first %}
										{{ first.product.name }}{% if order.items.count > 1 %} and {{ order.items.count|add:'-1' }} more{% endif %}
									{% else %}
										—
									{% endif %}
								{% endwith %}
							</td>
							<td style="padding:0.4rem 0.25rem;">₱{{ order.total_amount }}</td>
							<td style="padding:0.4rem 0.25rem;">
								{% if order.status == order.STATUS_PENDING %}
									<span style="padding:0.1rem 0.45rem; border-radius:999px; background:rgba(250,204,21,0.15); color:#f59e0b; border:1px solid rgba(250,204,21,0.7);">Pending</span>
								{% elif order.status == order.STATUS_PREPARING %}
									<span style="padding:0.1rem 0.45rem; border-radius:999px; background:rgba(248,113,113,0.15); color:#b91c1c; border:1px solid rgba(248,113,113,0.7);">Preparing</span>
								{% elif order.status == order.STATUS_READY_FOR_PICKUP %}
									<span style="padding:0.1rem 0.45rem; border-radius:999px; background:rgba(59,130,246,0.16); color:#1d4ed8; border:1px solid rgba(59,130,246,0.8);">Ready for pick up</span>
								{% elif order.status == order.STATUS_COMPLETED %}
									<span style="padding:0.1rem 0.45rem; border-radius:999px; background:rgba(34,197,94,0.16); color:#16a34a; border:1px solid rgba(34,197,94,0.8);">Completed</span>
								{% else %}
									<span style="padding:0.1rem 0.45rem; border-radius:999px; background:#f3f4f6; color:#6b7280; border:1px solid #e5e7eb;">{{ order.get_status_display }}</span>
								{% endif %}
								<form method="post" action="{% url 'admin_orders' %}" style="margin-top:0.25rem; display:flex; gap:0.25rem; align-items:center;">
									{% csrf_token %}
									<input type="hidden" name="order_id" value="{{ order.id }}">
									<select name="status" aria-label="Update order status" style="padding:0.1rem 0.15rem; font-size:0.8rem; border-radius:0.5rem; border:1px solid #d1d5db; background:#ffffff;">
										<option value="{{ order.STATUS_PENDING }}" {% if order.status == order.STATUS_PENDING %}selected{% endif %}>Pending</option>
										<option value="{{ order.STATUS_PREPARING }}" {% if order.status == order.STATUS_PREPARING %}selected{% endif %}>Preparing</option>
										<option value="{{ order.STATUS_READY_FOR_PICKUP }}" {% if order.status == order.STATUS_READY_FOR_PICKUP %}selected{% endif %}>Ready for pick up</option>
										<option value="{{ order.STATUS_COMPLETED }}" {% if order.status == order.STATUS_COMPLETED %}selected{% endif %}>Completed</option>
									</select>
									<button type="submit" style="padding:0.1rem 0.4rem; font-size:0.8rem; border-radius:999px; border:none; background:#111827; color:#f9fafb; cursor:pointer;">Update</button>
								</form>
							</td>
							<td style="padding:0.4rem 0.25rem; font-size:0.9rem; color:#6b7280;">{{ order.created_at|date:'Y-m-d H:i' }}</td>
						</tr>
					{% empty %}
						<tr>
							<td colspan="6" style="padding:0.4rem 0.25rem; font-size:0.9rem; color:#6b7280;">No orders yet.</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</section>
{% endblock %}
